<nav data-navbar role="navigation"
     class="fixed top-0 inset-x-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200 text-gray-900 transition-colors duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 grid grid-cols-[1fr_auto_1fr] items-center">

    <a href="{% url 'main:show_main' %}" class="font-extrabold text-lg tracking-tight justify-self-start">
      Toko <span class="text-violet-700">Bola Ega</span>
    </a>

    {% if categories %}
      <nav class="hidden md:flex items-center gap-1 justify-self-center">
        {% for code,label in categories %}
          <a href="{% url 'main:show_main' %}?filter={{ current_filter|default:'all' }}&category={{ code }}"
             class="px-3 py-1.5 rounded-full text-sm font-medium border transition
                    {% if current_category == code %}
                      bg-violet-600 text-white border-violet-600
                    {% else %}
                      text-violet-700 border-violet-200 hover:border-violet-400 hover:bg-violet-50
                    {% endif %}">
            {{ label }}
          </a>
        {% endfor %}
      </nav>
    {% endif %}

    <div class="hidden md:flex items-center gap-2 justify-self-end">
      {% if user.is_authenticated %}
        <a href="{% url 'main:create_product' %}" data-nav-cta
           class="px-3 py-2 rounded-lg bg-violet-600 text-white hover:bg-violet-700">Add Product</a>
        <a href="{% url 'main:logout' %}" data-nav-cta
           class="px-3 py-2 rounded-lg bg-violet-600 text-white hover:bg-violet-700">Logout</a>
      {% else %}
        <a href="{% url 'main:login' %}" data-nav-btn
           class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Login</a>
        <a href="{% url 'main:register' %}" data-nav-cta
           class="px-3 py-2 rounded-lg bg-violet-600 text-white hover:bg-violet-700">Register</a>
      {% endif %}
    </div>

    <button id="menu-btn" class="md:hidden justify-self-end p-2 rounded border border-gray-300 text-gray-700" aria-label="Menu">
      <div class="w-5 h-0.5 bg-current mb-1"></div>
      <div class="w-5 h-0.5 bg-current mb-1"></div>
      <div class="w-5 h-0.5 bg-current"></div>
    </button>
  </div>

  <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200 bg-white">
    <div class="px-4 py-3 space-y-2">
      {% if user.is_authenticated %}
        <a href="{% url 'main:create_product' %}" data-nav-cta
           class="block px-3 py-2 rounded bg-violet-600 text-white hover:bg-violet-700">Add Product</a>
        <a href="{% url 'main:logout' %}" data-nav-cta
           class="block px-3 py-2 rounded bg-violet-600 text-white hover:bg-violet-700">Logout</a>
      {% else %}
        <a href="{% url 'main:login' %}" data-nav-btn
           class="block px-3 py-2 rounded border border-gray-300 text-gray-700 hover:bg-gray-50">Login</a>
        <a href="{% url 'main:register' %}" data-nav-cta
           class="block px-3 py-2 rounded bg-violet-600 text-white hover:bg-violet-700">Register</a>
      {% endif %}
    </div>
  </div>

  <script>
    const nav = document.querySelector('[data-navbar]');
    const menuBtn = document.getElementById('menu-btn');
    const menu = document.getElementById('mobile-menu');
    const btns = () => document.querySelectorAll('[data-nav-btn]');
    const ctas = () => document.querySelectorAll('[data-nav-cta]');
    const hasHero = !!document.querySelector('[data-hero]');

    function reserveSpace(){ document.body.style.paddingTop = nav ? `${nav.offsetHeight}px` : '0px'; }
    function setGlass(){
      nav.classList.remove('bg-white/90','backdrop-blur','border-b','border-gray-200','text-gray-900');
      nav.classList.add('bg-transparent','border-transparent','text-white');
      btns().forEach(el => { el.classList.remove('border-gray-300','text-gray-700','hover:bg-gray-50');
                             el.classList.add('border-white/40','text-white','hover:bg-white/10'); });
      ctas().forEach(el => { el.classList.remove('bg-violet-600','text-white','hover:bg-violet-700');
                             el.classList.add('bg-white','text-violet-700','hover:bg-white/90'); });
      menuBtn?.classList.remove('border-gray-300','text-gray-700');
      menuBtn?.classList.add('border-white/40','text-white');
    }
    function setSolid(){
      nav.classList.remove('bg-transparent','border-transparent','text-white');
      nav.classList.add('bg-white/90','backdrop-blur','border-b','border-gray-200','text-gray-900');
      btns().forEach(el => { el.classList.remove('border-white/40','text-white','hover:bg-white/10');
                             el.classList.add('border-gray-300','text-gray-700','hover:bg-gray-50'); });
      ctas().forEach(el => { el.classList.remove('bg-white','text-violet-700','hover:bg-white/90');
                             el.classList.add('bg-violet-600','text-white','hover:bg-violet-700'); });
      menuBtn?.classList.remove('border-white/40','text-white');
      menuBtn?.classList.add('border-gray-300','text-gray-700');
    }
    function applyState(){ if (!hasHero){ setSolid(); return; } window.scrollY <= 10 ? setGlass() : setSolid(); }

    applyState(); reserveSpace();
    window.addEventListener('scroll', applyState);
    window.addEventListener('resize', reserveSpace);
    if ('ResizeObserver' in window){ new ResizeObserver(reserveSpace).observe(nav); }
    menuBtn?.addEventListener('click', () => { menu.classList.toggle('hidden'); reserveSpace(); });
  </script>
</nav>
